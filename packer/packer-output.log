[1;32mamazon-ebs: output will be in this color.[0m

[1;32m==> amazon-ebs: Prevalidating any provided VPC information[0m
[1;32m==> amazon-ebs: Prevalidating AMI Name: my-ami-1636579141[0m
[0;32m    amazon-ebs: Found Image ID: ami-03191f18e2403e784[0m
[1;32m==> amazon-ebs: Creating temporary keypair: packer_618c3745-a091-fd3a-3bf9-5deb4def8ce5[0m
[1;32m==> amazon-ebs: Creating temporary security group for this instance: packer_618c3748-01f1-3594-df1f-810a6862ef97[0m
[1;32m==> amazon-ebs: Authorizing access to port 22 from [0.0.0.0/0] in the temporary security groups...[0m
[1;32m==> amazon-ebs: Launching a source AWS instance...[0m
[1;32m==> amazon-ebs: Adding tags to source instance[0m
[0;32m    amazon-ebs: Adding tag: "Name": "Packer Builder"[0m
[0;32m    amazon-ebs: Instance ID: i-063c9658e2dce0225[0m
[1;32m==> amazon-ebs: Waiting for instance (i-063c9658e2dce0225) to become ready...[0m
[1;32m==> amazon-ebs: Using SSH communicator to connect: 34.221.204.124[0m
[1;32m==> amazon-ebs: Waiting for SSH to become available...[0m
[1;32m==> amazon-ebs: Connected to SSH![0m
[1;32m==> amazon-ebs: Provisioning with chef-solo[0m
[0;32m    amazon-ebs: Installing Chef...[0m
[1;31m==> amazon-ebs:   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current[0m
[1;31m==> amazon-ebs:                                  Dload  Upload   Total   Spent    Left  Speed[0m
[1;31m==> amazon-ebs: 100 23409  100 23409    0     0   331k      0 --:--:-- --:--:-- --:--:--  336k[0m
[0;32m    amazon-ebs: el 6 x86_64[0m
[0;32m    amazon-ebs: Getting information for chef stable 14 for el...[0m
[0;32m    amazon-ebs: downloading https://omnitruck.chef.io/stable/chef/metadata?v=14&p=el&pv=6&m=x86_64[0m
[0;32m    amazon-ebs:   to file /tmp/install.sh.2274/metadata.txt[0m
[0;32m    amazon-ebs: trying wget...[0m
[0;32m    amazon-ebs: sha1	9c575fb474a779dbd5cfde40572b9c311de065ad[0m
[0;32m    amazon-ebs: sha256	0d5d5a5d12eb929b62add67376d0a0942c28fa87b26367eb8700f02505cefde4[0m
[0;32m    amazon-ebs: url	https://packages.chef.io/files/stable/chef/14.15.6/el/6/chef-14.15.6-1.el6.x86_64.rpm[0m
[0;32m    amazon-ebs: version	14.15.6[0m
[0;32m    amazon-ebs: downloaded metadata file looks valid...[0m
[0;32m    amazon-ebs: downloading https://packages.chef.io/files/stable/chef/14.15.6/el/6/chef-14.15.6-1.el6.x86_64.rpm[0m
[0;32m    amazon-ebs:   to file /tmp/install.sh.2274/chef-14.15.6-1.el6.x86_64.rpm[0m
[0;32m    amazon-ebs: trying wget...[0m
[0;32m    amazon-ebs: Comparing checksum with sha256sum...[0m
[0;32m    amazon-ebs: Installing chef 14[0m
[0;32m    amazon-ebs: installing with rpm...[0m
[1;31m==> amazon-ebs: warning: /tmp/install.sh.2274/chef-14.15.6-1.el6.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID 83ef826a: NOKEY[0m
[0;32m    amazon-ebs: Preparing...                          ########################################[0m
[0;32m    amazon-ebs: Updating / installing...[0m
[0;32m    amazon-ebs: chef-14.15.6-1.el6                    ########################################[0m
[0;32m    amazon-ebs: Thank you for installing Chef Infra Client! For help getting started visit https://learn.chef.io[0m
[0;32m    amazon-ebs: Creating directory: /tmp/packer-chef-solo[0m
[0;32m    amazon-ebs: Creating directory: /tmp/packer-chef-solo/cookbooks-0[0m
[0;32m    amazon-ebs: Creating configuration file 'solo.rb'[0m
[0;32m    amazon-ebs: Creating JSON attribute file[0m
[0;32m    amazon-ebs: Executing Chef: sudo chef-solo --no-color -c /tmp/packer-chef-solo/solo.rb -j /tmp/packer-chef-solo/node.json[0m
[0;32m    amazon-ebs: Starting Chef Client, version 14.15.6[0m
[0;32m    amazon-ebs: resolving cookbooks for run list: ["my_wrapper"][0m
[0;32m    amazon-ebs: Synchronizing Cookbooks:[0m
[0;32m    amazon-ebs:   - my_wrapper (0.1.0)[0m
[0;32m    amazon-ebs:   - rails_demo (0.0.1)[0m
[0;32m    amazon-ebs:   - alternatives (0.2.0)[0m
[0;32m    amazon-ebs:   - yumgroup (0.6.0)[0m
[0;32m    amazon-ebs: Installing Cookbook Gems:[0m
[0;32m    amazon-ebs: Compiling Cookbooks...[0m
[0;32m    amazon-ebs: Converging 22 resources[0m
[0;32m    amazon-ebs: Recipe: rails_demo::default[0m
[0;32m    amazon-ebs:   * yum_package[git, ruby24, ruby24-libs, ruby24-irb, rubygems24, ruby24-devel, sqlite-devel] action install[0m
[0;32m    amazon-ebs:     - install version 0:2.18.5-2.73.amzn1.x86_64 of package git[0m
[0;32m    amazon-ebs:     - install version 0:2.4.10-2.15.amzn1.x86_64 of package ruby24[0m
[0;32m    amazon-ebs:     - install version 0:2.4.10-2.15.amzn1.x86_64 of package ruby24-libs[0m
[0;32m    amazon-ebs:     - install version 0:2.4.10-2.15.amzn1.noarch of package ruby24-irb[0m
[0;32m    amazon-ebs:     - install version 0:2.6.14.4-2.15.amzn1.noarch of package rubygems24[0m
[0;32m    amazon-ebs:     - install version 0:2.4.10-2.15.amzn1.x86_64 of package ruby24-devel[0m
[0;32m    amazon-ebs:     - install version 0:3.7.17-8.14.amzn1.x86_64 of package sqlite-devel[0m
[0;32m    amazon-ebs:   * yumgroup[Development Tools] action install[0m
[0;32m    amazon-ebs:     - Installing yum group Development Tools[0m
[0;32m    amazon-ebs:     * execute[yum -d0 -e0 -y  groupinstall 'Development Tools'] action run[0m
[0;32m    amazon-ebs:       - execute yum -d0 -e0 -y  groupinstall 'Development Tools'[0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs: Recipe: rails_demo::epll[0m
[0;32m    amazon-ebs:   * script[epll_rpm_download] action run[0m
[0;32m    amazon-ebs:     - execute "bash"  "/tmp/chef-script20211110-2444-1x93v1e"[0m
[0;32m    amazon-ebs:   * script[epll_rpm_import] action run[0m
[0;32m    amazon-ebs:     - execute "bash"  "/tmp/chef-script20211110-2444-dumtie"[0m
[0;32m    amazon-ebs:   * script[epll_package_list_download] action run[0m
[0;32m    amazon-ebs:     - execute "bash"  "/tmp/chef-script20211110-2444-1mhw23k"[0m
[0;32m    amazon-ebs:   * script[epll_package_list_add] action run[0m
[0;32m    amazon-ebs:     - execute "bash"  "/tmp/chef-script20211110-2444-15w78fy"[0m
[0;32m    amazon-ebs:   * script[epll_rpm_import] action nothing (skipped due to action :nothing)[0m
[0;32m    amazon-ebs:   * script[epll_package_list_download] action nothing (skipped due to action :nothing)[0m
[0;32m    amazon-ebs:   * script[epll_package_list_add] action nothing (skipped due to action :nothing)[0m
[0;32m    amazon-ebs: Recipe: rails_demo::default[0m
[0;32m    amazon-ebs:   * yum_package[nodejs4] action install[0m
[0;32m    amazon-ebs:     - install version 0:4.6.2-4.1.ll1.x86_64 of package nodejs4[0m
[0;32m    amazon-ebs:   * alternatives[use ruby2.4] action install[0m
[0;32m    amazon-ebs:     - adding alternative /usr/bin/ruby ruby /usr/bin/ruby2.4 100[0m
[0;32m    amazon-ebs:   * alternatives[use ruby2.4] action set[0m
[0;32m    amazon-ebs:     - setting alternative ruby /usr/bin/ruby2.4[0m
[0;32m    amazon-ebs:   * alternatives[use gem2.4] action install[0m
[0;32m    amazon-ebs:     - adding alternative /usr/bin/gem gem /usr/bin/gem2.4 100[0m
[0;32m    amazon-ebs:   * alternatives[use gem2.4] action set (up to date)[0m
[0;32m    amazon-ebs:   * alternatives[use irb2.4] action install[0m
[0;32m    amazon-ebs:     - adding alternative /usr/bin/irb irb /usr/bin/irb2.4 100[0m
[0;32m    amazon-ebs:   * alternatives[use irb2.4] action set (up to date)[0m
[0;32m    amazon-ebs:   * linux_user[apprunner] action create[0m
[0;32m    amazon-ebs:     - create user apprunner[0m
[0;32m    amazon-ebs:   * directory[/srv/rails_demo] action create[0m
[0;32m    amazon-ebs:     - create new directory /srv/rails_demo[0m
[0;32m    amazon-ebs:     - change owner from '' to 'apprunner'[0m
[0;32m    amazon-ebs:     - change group from '' to 'apprunner'[0m
[0;32m    amazon-ebs:   * gem_package[bundler] action install[0m
[0;32m    amazon-ebs:     - install version 2.2.31 of package bundler[0m
[0;32m    amazon-ebs:   * git[/srv/rails_demo] action sync[0m
[0;32m    amazon-ebs:     - clone from https://github.com/nkempel/rails_demo.git into /srv/rails_demo[0m
[0;32m    amazon-ebs:     - checkout ref 8bab37a381fca03c6dc4f2bbc121108610e75c34 branch master[0m
[0;32m    amazon-ebs:   * rails_prep[init_rails_app] action run[0m
[0;32m    amazon-ebs:     * execute[/usr/local/bin/bundle install --path vendor/bundle --jobs=4 --without development test] action run[0m
[0;32m    amazon-ebs:       - execute /usr/local/bin/bundle install --path vendor/bundle --jobs=4 --without development test[0m
[0;32m    amazon-ebs:     * execute[/usr/local/bin/bundle exec rake db:migrate] action run[0m
[0;32m    amazon-ebs:       - execute /usr/local/bin/bundle exec rake db:migrate[0m
[0;32m    amazon-ebs:     * execute[/usr/local/bin/bundle exec rake assets:precompile] action run[0m
[0;32m    amazon-ebs:       - execute /usr/local/bin/bundle exec rake assets:precompile[0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs:   * rails_prep[init_rails_app] action nothing (skipped due to action :nothing)[0m
[0;32m    amazon-ebs: Recipe: rails_demo::puma[0m
[0;32m    amazon-ebs:   * template[/etc/init.d/puma] action create[0m
[0;32m    amazon-ebs:     - create new file /etc/init.d/puma[0m
[0;32m    amazon-ebs:     - update content in file /etc/init.d/puma from none to 3e5280[0m
[0;32m    amazon-ebs:     --- /etc/init.d/puma	2021-11-10 21:21:37.544751000 +0000[0m
[0;32m    amazon-ebs:     +++ /etc/init.d/.chef-puma20211110-2444-1aa6eqx	2021-11-10 21:21:37.544751000 +0000[0m
[0;32m    amazon-ebs:     @@ -1 +1,81 @@[0m
[0;32m    amazon-ebs:     +#!/bin/bash[0m
[0;32m    amazon-ebs:     +#[0m
[0;32m    amazon-ebs:     +# puma		Manages the rails web server named after a cat[0m
[0;32m    amazon-ebs:     +#[0m
[0;32m    amazon-ebs:     +# chkconfig: - 85 15[0m
[0;32m    amazon-ebs:     +# description:  A ruby web server built for concurrency http://puma.io[0m
[0;32m    amazon-ebs:     +#               initscript to be placed in /etc/init.d.[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +### BEGIN INIT INFO[0m
[0;32m    amazon-ebs:     +# Provides: puma[0m
[0;32m    amazon-ebs:     +# Required-Start: $network $local_fs $remote_fs[0m
[0;32m    amazon-ebs:     +# Required-Stop: $network $local_fs $remote_fs[0m
[0;32m    amazon-ebs:     +# Should-Start: puma[0m
[0;32m    amazon-ebs:     +# Should-Stop:[0m
[0;32m    amazon-ebs:     +# Short-Description: start and stop puma[0m
[0;32m    amazon-ebs:     +# Description: puma, rails and lolcats[0m
[0;32m    amazon-ebs:     +### END INIT INFO[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Source function library.[0m
[0;32m    amazon-ebs:     +. /etc/init.d/functions[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +prog=puma[0m
[0;32m    amazon-ebs:     +lockfile=/var/run/$prog.pid[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +start() {[0m
[0;32m    amazon-ebs:     +	echo -n $"Starting up $prog: "[0m
[0;32m    amazon-ebs:     +	cd /srv/rails_demo[0m
[0;32m    amazon-ebs:     +  if [ -f .env ][0m
[0;32m    amazon-ebs:     +  then[0m
[0;32m    amazon-ebs:     +  	source .env[0m
[0;32m    amazon-ebs:     +  fi[0m
[0;32m    amazon-ebs:     +	/usr/local/bin/bundle exec ./vendor/bundle/ruby/2.4/bin/pumactl start[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +	RETVAL=$?[0m
[0;32m    amazon-ebs:     +	echo[0m
[0;32m    amazon-ebs:     +	[ $RETVAL -eq 0 ][0m
[0;32m    amazon-ebs:     +	return $RETVAL[0m
[0;32m    amazon-ebs:     +}[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +stop() {[0m
[0;32m    amazon-ebs:     +  echo -n $"Shutting down $prog: "[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +	cd /srv/rails_demo[0m
[0;32m    amazon-ebs:     +  /usr/local/bin/bundle exec ./vendor/bundle/ruby/2.4/bin/pumactl start[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +	killproc $prog[0m
[0;32m    amazon-ebs:     +	RETVAL=$?[0m
[0;32m    amazon-ebs:     +        echo[0m
[0;32m    amazon-ebs:     +	[ $RETVAL -eq 0 ] && rm -f $lockfile[0m
[0;32m    amazon-ebs:     +	return $RETVAL[0m
[0;32m    amazon-ebs:     +}[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# See how we were called.[0m
[0;32m    amazon-ebs:     +case "$1" in[0m
[0;32m    amazon-ebs:     +  start)[0m
[0;32m    amazon-ebs:     +	start[0m
[0;32m    amazon-ebs:     +	;;[0m
[0;32m    amazon-ebs:     +  stop)[0m
[0;32m    amazon-ebs:     +	stop[0m
[0;32m    amazon-ebs:     +	;;[0m
[0;32m    amazon-ebs:     +  status)[0m
[0;32m    amazon-ebs:     +	status $prog[0m
[0;32m    amazon-ebs:     +	;;[0m
[0;32m    amazon-ebs:     +  restart|force-reload)[0m
[0;32m    amazon-ebs:     +	stop[0m
[0;32m    amazon-ebs:     +	start[0m
[0;32m    amazon-ebs:     +	;;[0m
[0;32m    amazon-ebs:     +  try-restart|condrestart)[0m
[0;32m    amazon-ebs:     +	if status $prog > /dev/null; then[0m
[0;32m    amazon-ebs:     +	    stop[0m
[0;32m    amazon-ebs:     +	    start[0m
[0;32m    amazon-ebs:     +	fi[0m
[0;32m    amazon-ebs:     +	;;[0m
[0;32m    amazon-ebs:     +  reload)[0m
[0;32m    amazon-ebs:     +	exit 3[0m
[0;32m    amazon-ebs:     +	;;[0m
[0;32m    amazon-ebs:     +  *)[0m
[0;32m    amazon-ebs:     +	echo $"Usage: $0 {start|stop|status|restart|try-restart|force-reload}"[0m
[0;32m    amazon-ebs:     +	exit 2[0m
[0;32m    amazon-ebs:     +esac[0m
[0;32m    amazon-ebs:     - change mode from '' to '0755'[0m
[0;32m    amazon-ebs:   * template[/srv/rails_demo/config/puma.rb] action create[0m
[0;32m    amazon-ebs:     - create new file /srv/rails_demo/config/puma.rb[0m
[0;32m    amazon-ebs:     - update content in file /srv/rails_demo/config/puma.rb from none to 4aeae1[0m
[0;32m    amazon-ebs:     --- /srv/rails_demo/config/puma.rb	2021-11-10 21:21:37.552751000 +0000[0m
[0;32m    amazon-ebs:     +++ /srv/rails_demo/config/.chef-puma20211110-2444-vnhyyc.rb	2021-11-10 21:21:37.552751000 +0000[0m
[0;32m    amazon-ebs:     @@ -1 +1,48 @@[0m
[0;32m    amazon-ebs:     +# Puma can serve each request in a thread from an internal thread pool.[0m
[0;32m    amazon-ebs:     +# The `threads` method setting takes two numbers: a minimum and maximum.[0m
[0;32m    amazon-ebs:     +# Any libraries that use thread pools should be configured to match[0m
[0;32m    amazon-ebs:     +# the maximum value specified for Puma. Default is set to 5 threads for minimum[0m
[0;32m    amazon-ebs:     +# and maximum; this matches the default thread size of Active Record.[0m
[0;32m    amazon-ebs:     +#[0m
[0;32m    amazon-ebs:     +threads_count = ENV.fetch("RAILS_MAX_THREADS") { 5 }[0m
[0;32m    amazon-ebs:     +threads threads_count, threads_count[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Specifies the `port` that Puma will listen on to receive requests; default is 3000.[0m
[0;32m    amazon-ebs:     +#[0m
[0;32m    amazon-ebs:     +port        ENV.fetch("PORT") { 3000 }[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Specifies the `environment` that Puma will run in.[0m
[0;32m    amazon-ebs:     +#[0m
[0;32m    amazon-ebs:     +environment ENV.fetch("RAILS_ENV") { "development" }[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Specifies the number of `workers` to boot in clustered mode.[0m
[0;32m    amazon-ebs:     +# Workers are forked webserver processes. If using threads and workers together[0m
[0;32m    amazon-ebs:     +# the concurrency of the application would be max `threads` * `workers`.[0m
[0;32m    amazon-ebs:     +# Workers do not work on JRuby or Windows (both of which do not support[0m
[0;32m    amazon-ebs:     +# processes).[0m
[0;32m    amazon-ebs:     +#[0m
[0;32m    amazon-ebs:     +# workers ENV.fetch("WEB_CONCURRENCY") { 2 }[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Use the `preload_app!` method when specifying a `workers` number.[0m
[0;32m    amazon-ebs:     +# This directive tells Puma to first boot the application and load code[0m
[0;32m    amazon-ebs:     +# before forking the application. This takes advantage of Copy On Write[0m
[0;32m    amazon-ebs:     +# process behavior so workers use less memory.[0m
[0;32m    amazon-ebs:     +#[0m
[0;32m    amazon-ebs:     +# preload_app![0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Allow puma to be restarted by `rails restart` command.[0m
[0;32m    amazon-ebs:     +plugin :tmp_restart[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Daemonize the server into the background. Highly suggest that[0m
[0;32m    amazon-ebs:     +# this be combined with â€œpidfileâ€ and â€œstdout_redirectâ€.[0m
[0;32m    amazon-ebs:     +# The default is â€œfalseâ€.[0m
[0;32m    amazon-ebs:     +daemonize true[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Store the pid of the server in the file at â€œpathâ€.[0m
[0;32m    amazon-ebs:     +pidfile '/var/run/puma.pid'[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +# Use â€œpathâ€ as the file to store the server info state. This is[0m
[0;32m    amazon-ebs:     +# used by â€œpumactlâ€ to query and control the server.[0m
[0;32m    amazon-ebs:     +state_path '/var/run/puma.state'[0m
[0;32m    amazon-ebs:     +directory '/srv/rails_demo'[0m
[0;32m    amazon-ebs:     - change mode from '' to '0644'[0m
[0;32m    amazon-ebs:   * service[puma] action enable[0m
[0;32m    amazon-ebs:     - enable service service[puma][0m
[0;32m    amazon-ebs:   * service[puma] action start[0m
[0;32m    amazon-ebs:     - start service service[puma][0m
[0;32m    amazon-ebs: Recipe: rails_demo::nginx[0m
[0;32m    amazon-ebs:   * yum_package[nginx] action install[0m
[0;32m    amazon-ebs:     - install version 1:1.18.0-1.43.amzn1.x86_64 of package nginx[0m
[0;32m    amazon-ebs:   * cookbook_file[/etc/nginx/nginx.conf] action create[0m
[0;32m    amazon-ebs:     - update content in file /etc/nginx/nginx.conf from 08ca7d to a8c801[0m
[0;32m    amazon-ebs:     --- /etc/nginx/nginx.conf	2021-05-25 19:52:01.000000000 +0000[0m
[0;32m    amazon-ebs:     +++ /etc/nginx/.chef-nginx20211110-2444-1iw2m4h.conf	2021-11-10 21:21:39.500751000 +0000[0m
[0;32m    amazon-ebs:     @@ -7,7 +7,7 @@[0m
[0;32m    amazon-ebs:      error_log /var/log/nginx/error.log;[0m
[0;32m    amazon-ebs:      pid /var/run/nginx.pid;[0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs:     -# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.[0m
[0;32m    amazon-ebs:     +# Load dynamic modules. See /usr/share/nginx/README.fedora.[0m
[0;32m    amazon-ebs:      include /usr/share/nginx/modules/*.conf;[0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs:      events {[0m
[0;32m    amazon-ebs:     @@ -21,11 +21,18 @@[0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs:          access_log  /var/log/nginx/access.log  main;[0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs:     +    # enable gzip compressing INF-975[0m
[0;32m    amazon-ebs:     +    gzip on;[0m
[0;32m    amazon-ebs:     +    gzip_types  text/plain text/css application/xml application/json;[0m
[0;32m    amazon-ebs:     +    gzip_min_length 1000;[0m
[0;32m    amazon-ebs:     +    gzip_comp_level 6;[0m
[0;32m    amazon-ebs:     +    gzip_proxied any;[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:          sendfile            on;[0m
[0;32m    amazon-ebs:          tcp_nopush          on;[0m
[0;32m    amazon-ebs:          tcp_nodelay         on;[0m
[0;32m    amazon-ebs:          keepalive_timeout   65;[0m
[0;32m    amazon-ebs:     -    types_hash_max_size 4096;[0m
[0;32m    amazon-ebs:     +    types_hash_max_size 2048;[0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs:          include             /etc/nginx/mime.types;[0m
[0;32m    amazon-ebs:          default_type        application/octet-stream;[0m
[0;32m    amazon-ebs:     @@ -36,83 +43,5 @@[0m
[0;32m    amazon-ebs:          include /etc/nginx/conf.d/*.conf;[0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs:          index   index.html index.htm;[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     -    server {[0m
[0;32m    amazon-ebs:     -        listen       80;[0m
[0;32m    amazon-ebs:     -        listen       [::]:80;[0m
[0;32m    amazon-ebs:     -        server_name  _;[0m
[0;32m    amazon-ebs:     -        root         /usr/share/nginx/html;[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     -        # Load configuration files for the default server block.[0m
[0;32m    amazon-ebs:     -        include /etc/nginx/default.d/*.conf;[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     -        # redirect server error pages to the static page /40x.html[0m
[0;32m    amazon-ebs:     -        #[0m
[0;32m    amazon-ebs:     -        error_page 404 /404.html;[0m
[0;32m    amazon-ebs:     -            location = /40x.html {[0m
[0;32m    amazon-ebs:     -        }[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     -        # redirect server error pages to the static page /50x.html[0m
[0;32m    amazon-ebs:     -        #[0m
[0;32m    amazon-ebs:     -        error_page 500 502 503 504 /50x.html;[0m
[0;32m    amazon-ebs:     -            location = /50x.html {[0m
[0;32m    amazon-ebs:     -        }[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     -        # proxy the PHP scripts to Apache listening on 127.0.0.1:80[0m
[0;32m    amazon-ebs:     -        #[0m
[0;32m    amazon-ebs:     -        #location ~ \.php$ {[0m
[0;32m    amazon-ebs:     -        #    proxy_pass   http://127.0.0.1;[0m
[0;32m    amazon-ebs:     -        #}[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     -        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000[0m
[0;32m    amazon-ebs:     -        #[0m
[0;32m    amazon-ebs:     -        #location ~ \.php$ {[0m
[0;32m    amazon-ebs:     -        #    root           html;[0m
[0;32m    amazon-ebs:     -        #    fastcgi_pass   127.0.0.1:9000;[0m
[0;32m    amazon-ebs:     -        #    fastcgi_index  index.php;[0m
[0;32m    amazon-ebs:     -        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;[0m
[0;32m    amazon-ebs:     -        #    include        fastcgi_params;[0m
[0;32m    amazon-ebs:     -        #}[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     -        # deny access to .htaccess files, if Apache's document root[0m
[0;32m    amazon-ebs:     -        # concurs with nginx's one[0m
[0;32m    amazon-ebs:     -        #[0m
[0;32m    amazon-ebs:     -        #location ~ /\.ht {[0m
[0;32m    amazon-ebs:     -        #    deny  all;[0m
[0;32m    amazon-ebs:     -        #}[0m
[0;32m    amazon-ebs:     -    }[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     -# Settings for a TLS enabled server.[0m
[0;32m    amazon-ebs:     -#[0m
[0;32m    amazon-ebs:     -#    server {[0m
[0;32m    amazon-ebs:     -#        listen       443 ssl http2;[0m
[0;32m    amazon-ebs:     -#        listen       [::]:443 ssl http2;[0m
[0;32m    amazon-ebs:     -#        server_name  _;[0m
[0;32m    amazon-ebs:     -#        root         /usr/share/nginx/html;[0m
[0;32m    amazon-ebs:     -#[0m
[0;32m    amazon-ebs:     -#        ssl_certificate "/etc/pki/nginx/server.crt";[0m
[0;32m    amazon-ebs:     -#        ssl_certificate_key "/etc/pki/nginx/private/server.key";[0m
[0;32m    amazon-ebs:     -#        # It is *strongly* recommended to generate unique DH parameters[0m
[0;32m    amazon-ebs:     -#        # Generate them with: openssl dhparam -out /etc/pki/nginx/dhparams.pem 2048[0m
[0;32m    amazon-ebs:     -#        #ssl_dhparam "/etc/pki/nginx/dhparams.pem";[0m
[0;32m    amazon-ebs:     -#        ssl_session_cache shared:SSL:1m;[0m
[0;32m    amazon-ebs:     -#        ssl_session_timeout  10m;[0m
[0;32m    amazon-ebs:     -#        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;[0m
[0;32m    amazon-ebs:     -#        ssl_ciphers HIGH:SEED:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!RSAPSK:!aDH:!aECDH:!EDH-DSS-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA:!SRP;[0m
[0;32m    amazon-ebs:     -#        ssl_prefer_server_ciphers on;[0m
[0;32m    amazon-ebs:     -#[0m
[0;32m    amazon-ebs:     -#        # Load configuration files for the default server block.[0m
[0;32m    amazon-ebs:     -#        include /etc/nginx/default.d/*.conf;[0m
[0;32m    amazon-ebs:     -#[0m
[0;32m    amazon-ebs:     -#        error_page 404 /404.html;[0m
[0;32m    amazon-ebs:     -#            location = /40x.html {[0m
[0;32m    amazon-ebs:     -#        }[0m
[0;32m    amazon-ebs:     -#[0m
[0;32m    amazon-ebs:     -#        error_page 500 502 503 504 /50x.html;[0m
[0;32m    amazon-ebs:     -#            location = /50x.html {[0m
[0;32m    amazon-ebs:     -#        }[0m
[0;32m    amazon-ebs:     -#    }[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:      }[0m
[0;32m    amazon-ebs:     -[0m
[0;32m    amazon-ebs:     - change mode from '0644' to '0600'[0m
[0;32m    amazon-ebs:   * template[/etc/nginx/conf.d/rails_demo.conf] action create[0m
[0;32m    amazon-ebs:     - create new file /etc/nginx/conf.d/rails_demo.conf[0m
[0;32m    amazon-ebs:     - update content in file /etc/nginx/conf.d/rails_demo.conf from none to 52db2d[0m
[0;32m    amazon-ebs:     --- /etc/nginx/conf.d/rails_demo.conf	2021-11-10 21:21:39.528751000 +0000[0m
[0;32m    amazon-ebs:     +++ /etc/nginx/conf.d/.chef-rails_demo20211110-2444-cz2tjc.conf	2021-11-10 21:21:39.528751000 +0000[0m
[0;32m    amazon-ebs:     @@ -1 +1,58 @@[0m
[0;32m    amazon-ebs:     +upstream puma {[0m
[0;32m    amazon-ebs:     +  server localhost:3000;[0m
[0;32m    amazon-ebs:     +  # server unix:///tmp/puma.sock;[0m
[0;32m    amazon-ebs:     +}[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +server {[0m
[0;32m    amazon-ebs:     +  listen 80 default_server deferred;[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +  root /srv/rails_demo/public;[0m
[0;32m    amazon-ebs:     +  access_log /srv/rails_demo/log/nginx.access.log main;[0m
[0;32m    amazon-ebs:     +  error_log /srv/rails_demo/log/nginx.error.log info;[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +  # enable gzip compression 3/31/2017 INF-975[0m
[0;32m    amazon-ebs:     +  gzip on;[0m
[0;32m    amazon-ebs:     +  gzip_types  text/plain text/css application/xml application/json;[0m
[0;32m    amazon-ebs:     +  gzip_min_length 1000;[0m
[0;32m    amazon-ebs:     +  gzip_comp_level 6;[0m
[0;32m    amazon-ebs:     +  gzip_proxied any;[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +  location ^~ /assets/ {[0m
[0;32m    amazon-ebs:     +    gzip_static on;[0m
[0;32m    amazon-ebs:     +    expires max;[0m
[0;32m    amazon-ebs:     +    add_header Cache-Control public;[0m
[0;32m    amazon-ebs:     +  }[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +  try_files $uri/index.html $uri @puma;[0m
[0;32m    amazon-ebs:     +  location @puma {[0m
[0;32m    amazon-ebs:     +    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;[0m
[0;32m    amazon-ebs:     +    proxy_set_header Host $http_host;[0m
[0;32m    amazon-ebs:     +    proxy_redirect off;[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +    proxy_pass http://puma;[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +    proxy_buffering off;[0m
[0;32m    amazon-ebs:     +    proxy_connect_timeout 159s;[0m
[0;32m    amazon-ebs:     +    proxy_send_timeout   600;[0m
[0;32m    amazon-ebs:     +    proxy_read_timeout   600;[0m
[0;32m    amazon-ebs:     +    proxy_buffer_size    64k;[0m
[0;32m    amazon-ebs:     +    proxy_buffers     16 32k;[0m
[0;32m    amazon-ebs:     +    proxy_busy_buffers_size 64k;[0m
[0;32m    amazon-ebs:     +    proxy_temp_file_write_size 64k;[0m
[0;32m    amazon-ebs:     +    proxy_pass_header Set-Cookie;[0m
[0;32m    amazon-ebs:     +    proxy_redirect     off;[0m
[0;32m    amazon-ebs:     +    proxy_hide_header  Vary;[0m
[0;32m    amazon-ebs:     +    proxy_set_header   Accept-Encoding '';[0m
[0;32m    amazon-ebs:     +    proxy_ignore_headers Cache-Control Expires;[0m
[0;32m    amazon-ebs:     +    proxy_set_header   Referer $http_referer;[0m
[0;32m    amazon-ebs:     +    proxy_set_header   Cookie $http_cookie;[0m
[0;32m    amazon-ebs:     +    proxy_set_header   X-Real-IP  $remote_addr;[0m
[0;32m    amazon-ebs:     +    proxy_set_header X-Forwarded-Host $host;[0m
[0;32m    amazon-ebs:     +    proxy_set_header X-Forwarded-Server $host;[0m
[0;32m    amazon-ebs:     +  }[0m
[0;32m    amazon-ebs:     +[0m
[0;32m    amazon-ebs:     +  error_page 500 502 503 504 /500.html;[0m
[0;32m    amazon-ebs:     +  client_max_body_size 50M;[0m
[0;32m    amazon-ebs:     +  keepalive_timeout 10;[0m
[0;32m    amazon-ebs:     +}[0m
[0;32m    amazon-ebs:     - change mode from '' to '0600'[0m
[0;32m    amazon-ebs:   * service[nginx] action enable[0m
[0;32m    amazon-ebs:     - enable service service[nginx][0m
[0;32m    amazon-ebs:   * service[nginx] action start[0m
[0;32m    amazon-ebs:     - start service service[nginx][0m
[0;32m    amazon-ebs: Recipe: rails_demo::puma[0m
[0;32m    amazon-ebs:   * service[puma] action restart[0m
[0;32m    amazon-ebs:     - restart service service[puma][0m
[0;32m    amazon-ebs: Recipe: rails_demo::nginx[0m
[0;32m    amazon-ebs:   * service[nginx] action restart[0m
[0;32m    amazon-ebs:     - restart service service[nginx][0m
[0;32m    amazon-ebs:[0m
[0;32m    amazon-ebs: Running handlers:[0m
[0;32m    amazon-ebs: Running handlers complete[0m
[0;32m    amazon-ebs: Chef Client finished, 31/37 resources updated in 01 minutes 57 seconds[0m
[1;32m==> amazon-ebs: Stopping the source instance...[0m
[0;32m    amazon-ebs: Stopping instance[0m
[1;32m==> amazon-ebs: Waiting for the instance to stop...[0m
[1;32m==> amazon-ebs: Creating AMI my-ami-1636579141 from instance i-063c9658e2dce0225[0m
[0;32m    amazon-ebs: AMI: ami-0433d36f7eb1311d5[0m
[1;32m==> amazon-ebs: Waiting for AMI to become ready...[0m
[1;32m==> amazon-ebs: Adding tags to AMI (ami-0433d36f7eb1311d5)...[0m
[1;32m==> amazon-ebs: Tagging snapshot: snap-0fdbd94beea794ecb[0m
[1;32m==> amazon-ebs: Creating AMI tags[0m
[0;32m    amazon-ebs: Adding tag: "application": "img-mgr"[0m
[0;32m    amazon-ebs: Adding tag: "created-by": "packer"[0m
[1;32m==> amazon-ebs: Creating snapshot tags[0m
[1;32m==> amazon-ebs: Skipping Enable AMI deprecation...[0m
[1;32m==> amazon-ebs: Terminating the source AWS instance...[0m
[1;32m==> amazon-ebs: Cleaning up any extra volumes...[0m
[1;32m==> amazon-ebs: No volumes to clean up, skipping[0m
[1;32m==> amazon-ebs: Deleting temporary security group...[0m
[1;32m==> amazon-ebs: Deleting temporary keypair...[0m
[1;32mBuild 'amazon-ebs' finished after 6 minutes 54 seconds.[0m

==> Wait completed after 6 minutes 54 seconds

==> Builds finished. The artifacts of successful builds are:
--> amazon-ebs: AMIs were created:
us-west-2: ami-0433d36f7eb1311d5

